<html><head><link rel="import" href="../polymer/polymer.html">

</head><body><dom-module id="juicy-filedrop">
    <template>
        <style>:host{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;}input[type=file]{display:none;}</style>
        <input type="file" id="txtUploadFile">
        <content id="content"></content>
    </template>
    <script>"use strict";Polymer({is:"juicy-filedrop",properties:{allowedmimetypes:{notify:!0},customheader:{type:String,value:"x-file",notify:!0},maxfilesize:{notify:!0},url:{type:String,value:"",notify:!0},value:{notify:!0}},ready:function(){this.setupDrop(),this.setupSelect(),this.maxfilesize||(this.maxfilesize=524288),this.allowedmimetypes?"string"==typeof this.allowedmimetypes&&(this.allowedmimetypes=this.allowedmimetypes.split(",")):this.allowedmimetypes=["image/gif","image/jpeg","image/png","image/svg+xml"]},checkFile:function(e){var t;return this.allowedmimetypes.indexOf(e.type)<0?(t=e.type?"File type ["+e.type+"] is not allowed.":e.name+" has invalid mime type.",this.fire("fileSelectError",{file:e,message:t}),!1):!(e.size>this.maxfilesize)||(t=["File ",e.name," is too big. Maximum file size is: ",this.maxfilesize/1024,"kb."].join(""),this.fire("fileSelectError",{file:e,message:t}),!1)},openFile:function(){var e=this.$.txtUploadFile;e.click()},fileToJson:function(e){return JSON.stringify({type:e.type,name:encodeURIComponent(e.name)})},readData:function(e){var t=new FileReader,i=this;t.onload=function(e){var t=new XMLHttpRequest;t.open("POST",i.url),t.setRequestHeader(i.customheader,i.fileToJson(this.xFile)),t.onload=function(e){this.status>=200&&this.status<300?i.handleResponse(e,this):i.handleError(e,this)},t.onerror=function(e){i.handleError(e,this)},t.xFile=this.xFile,t.send(e.target.result)},t.xFile={type:e.type,name:e.name},this.fire("fileUploading",t.xFile),t.readAsDataURL(e)},setupSelect:function(){var e=function(e){for(var t=e.target.files,i=0;i<t.length;i++){var s=t[i];this.checkFile(s)&&this.readData(t[i])}};this.$.txtUploadFile.addEventListener("change",e.bind(this),!1)},setupDrop:function(){"undefined"==typeof window.FileReader,this.onpaste=function(e){for(var t,i=0;t=e.clipboardData.items[i];i++)if("file"==t.kind){var s=t.getAsFile();this.readData(s)}},this.ondragleave=function(){this.classList.contains("hover")&&this.classList.remove("hover")},this.ondragover=function(e){return e.stopPropagation(),this.classList.contains("hover")||this.classList.add("hover"),!1},this.ondragend=function(){return this.classList.contains("hover")&&this.classList.remove("hover"),!1},this.ondrop=function(e){this.classList.contains("hover")&&this.classList.remove("hover"),e.preventDefault();for(var t,i=0;t=e.dataTransfer.files[i];i++)this.checkFile(t)&&this.readData(t);return!1}},handleResponse:function(e,t){this.value=t.getResponseHeader("x-file-location");var i=JSON.parse(t.getResponseHeader(this.customheader));i.status=t.status,i.statusText=t.statusText,this.fire("fileUploaded",i)},handleError:function(e,t){var i=t.xFile;i.status=t.status,i.statusText=t.statusText,this.fire("fileUploadError",i)}});</script>
</dom-module>
</body></html>